# Vedfolnir MySQL Configuration Template
# Copy this file to .env and configure your settings

# =============================================================================
# CORE APPLICATION SETTINGS
# =============================================================================

# App version
APP_VERSION=0.001

# Flask Application
FLASK_HOST=127.0.0.1
FLASK_PORT=5000
FLASK_DEBUG=false

# Flask Secret Key - REQUIRED for session security and CSRF protection
# Generate a secure key using: python3 -c "import secrets; print(secrets.token_urlsafe(32))"
# NEVER use the example value below in production!
FLASK_SECRET_KEY=cNhxjHQKDtNkYF5LuIHZtLVhTLT9fHqlqPJE6wEd8Lg

# =============================================================================
# DATABASE CONFIGURATION - MySQL with Unix Socket
# =============================================================================

# Database Type
DB_TYPE=mysql

# MySQL Database Configuration
DB_NAME=vedfolnir
DB_USER=database_user
DB_PASSWORD=database_password
DB_UNIX_SOCKET=/var/run/mysqld/mysqld.sock
DATABASE_URL=mysql+pymysql://database_user_1d7b0d0696a20:EQA%26bok7@localhost/vedfolnir?unix_socket=/tmp/mysql.sock&charset=utf8mb4

# =============================================================================
# REDIS CONFIGURATION (UNCHANGED)
# =============================================================================

# Redis Configuration for Session Storage
REDIS_URL=redis://:ZkjBdCsoodbvY6EpXF@localhost:6379/0
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=ZkjBdCsoodbvY6EpXF
REDIS_SSL=false

SESSION_STORAGE=redis

# Redis Session Settings
REDIS_SESSION_PREFIX=vedfolnir:session:
REDIS_SESSION_TIMEOUT=7200  # Session timeout in seconds (2 hours)
REDIS_SESSION_CLEANUP_INTERVAL=3600  # Cleanup interval in seconds (1 hour)

# Flask Session Cookie Configuration
SESSION_COOKIE_NAME=session
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SECURE=true  # Set to false for development over HTTP
SESSION_COOKIE_SAMESITE=Lax
SESSION_COOKIE_MAX_AGE=7200  # Cookie max age in seconds (2 hours)

# Database Session Fallback
DB_SESSION_FALLBACK=true  # Enable database fallback for session persistence
DB_SESSION_SYNC=true      # Sync session data between Redis and database

# =============================================================================
# DATABASE PERFORMANCE CONFIGURATION
# =============================================================================

# Database Performance Configuration (MySQL Optimized)
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=50
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600
DB_QUERY_LOGGING=false

# =============================================================================
# AI/ML CONFIGURATION
# =============================================================================

# Ollama Configuration
OLLAMA_URL=http://Mac-mini-M2.local:11434
OLLAMA_MODEL=llava:7b
OLLAMA_TIMEOUT=60.0

# =============================================================================
# CAPTION GENERATION SETTINGS
# =============================================================================

# Caption Configuration
CAPTION_MAX_LENGTH=500
CAPTION_OPTIMAL_MIN_LENGTH=150
CAPTION_OPTIMAL_MAX_LENGTH=450
CAPTION_MAX_STORAGE_GB=5

# Enhanced Image Classification
USE_ENHANCED_CLASSIFICATION=true
CLASSIFICATION_CONFIDENCE_THRESHOLD=0.7
LLAVA_CLASSIFICATION_TEMPERATURE=0.1

# Fallback Configuration
FALLBACK_ENABLED=true
FALLBACK_MAX_ATTEMPTS=2
FALLBACK_USE_SIMPLIFIED_PROMPTS=true
FALLBACK_USE_BACKUP_MODEL=true
FALLBACK_BACKUP_MODEL=llava:13b-v1.6

# =============================================================================
# PROCESSING CONFIGURATION
# =============================================================================

# Processing Limits
MAX_POSTS_PER_RUN=10
MAX_USERS_PER_RUN=10
USER_PROCESSING_DELAY=5
DRY_RUN=true

# Batch Update Configuration
BATCH_UPDATE_ENABLED=true
BATCH_UPDATE_SIZE=5
BATCH_UPDATE_MAX_CONCURRENT=2
BATCH_UPDATE_VERIFICATION_DELAY=2
BATCH_UPDATE_ROLLBACK_ON_FAILURE=true

# =============================================================================
# RETRY AND RATE LIMITING
# =============================================================================

# Retry Configuration
RETRY_MAX_ATTEMPTS=3
RETRY_BASE_DELAY=1.0
RETRY_MAX_DELAY=30.0
RETRY_BACKOFF_FACTOR=2.0
RETRY_USE_JITTER=true
RETRY_JITTER_FACTOR=0.1
RETRY_ON_TIMEOUT=true
RETRY_ON_CONNECTION_ERROR=true
RETRY_ON_SERVER_ERROR=true
RETRY_ON_RATE_LIMIT=true
RETRY_SPECIFIC_ERRORS=connection reset by peer,connection refused,temporary failure

# Rate Limiting Configuration
RATE_LIMIT_REQUESTS_PER_MINUTE=60
RATE_LIMIT_REQUESTS_PER_HOUR=1000
RATE_LIMIT_REQUESTS_PER_DAY=10000
RATE_LIMIT_MAX_BURST=10

# Endpoint-specific rate limits
RATE_LIMIT_ENDPOINT_MEDIA_MINUTE=30
RATE_LIMIT_ENDPOINT_MEDIA_HOUR=300
RATE_LIMIT_ENDPOINT_STATUSES_MINUTE=60
RATE_LIMIT_ENDPOINT_STATUSES_HOUR=600

# =============================================================================
# AUTHENTICATION AND SECURITY
# =============================================================================

# Authentication Configuration
AUTH_REQUIRE_AUTH=true
AUTH_SESSION_LIFETIME=86400
AUTH_REMEMBER_COOKIE_DURATION=2592000

# Platform Encryption Key - REQUIRED for encrypting stored platform credentials
# Generate using: python3 -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
# This key encrypts API tokens and credentials stored in the database
# If lost, all stored platform credentials become unrecoverable
# NEVER use the example value below in production!
PLATFORM_ENCRYPTION_KEY=ffiVmp_30S0oemUIkEQ8tHXhQh3U-lyLMMLA2Fj_m2U=

# =============================================================================
# SESSION MANAGEMENT CONFIGURATION (UNCHANGED)
# =============================================================================

# Session Environment (development, testing, staging, production)
SESSION_ENVIRONMENT=development
SESSION_DEBUG_MODE=false

# Testing Configuration
DISABLE_CSRF_FOR_TESTING=false

# Session Timeout Configuration
SESSION_LIFETIME_SECONDS=172800  # 48 hours
SESSION_IDLE_TIMEOUT_SECONDS=86400  # 24 hours
SESSION_ABSOLUTE_TIMEOUT_SECONDS=604800  # 7 days
SESSION_EXPIRATION_GRACE_SECONDS=300  # 5 minutes
SESSION_CLEANUP_GRACE_SECONDS=600  # 10 minutes
SESSION_WARNING_THRESHOLD_SECONDS=900  # 15 minutes

# Session Cleanup Configuration
SESSION_CLEANUP_INTERVAL_SECONDS=1800  # 30 minutes
SESSION_BATCH_CLEANUP_INTERVAL_SECONDS=21600  # 6 hours
SESSION_DEEP_CLEANUP_INTERVAL_SECONDS=86400  # 24 hours
SESSION_CLEANUP_BATCH_SIZE=100
SESSION_MAX_CLEANUP_BATCHES=10
SESSION_MAX_EXPIRED_THRESHOLD=1000
SESSION_CLEANUP_TRIGGER_THRESHOLD=500
SESSION_EXPIRED_RETENTION_DAYS=7
SESSION_AUDIT_RETENTION_DAYS=30

# Cross-Tab Synchronization Configuration
SESSION_SYNC_CHECK_INTERVAL_SECONDS=2
SESSION_HEARTBEAT_INTERVAL_SECONDS=30
SESSION_SYNC_TIMEOUT_SECONDS=5
SESSION_TAB_RESPONSE_TIMEOUT_SECONDS=3
SESSION_LOCALSTORAGE_PREFIX=vedfolnir_session_
SESSION_MAX_SYNC_DATA_SIZE=1024

# Session Security Configuration
SESSION_ENABLE_FINGERPRINTING=true
SESSION_ENABLE_SUSPICIOUS_DETECTION=true
SESSION_ENABLE_AUDIT_LOGGING=true
SESSION_MAX_CONCURRENT_PER_USER=5
SESSION_SUSPICIOUS_ACTIVITY_THRESHOLD=10
SESSION_MAX_PLATFORM_SWITCHES_PER_HOUR=50
SESSION_SECURITY_CHECK_INTERVAL_SECONDS=300

# Session Monitoring Configuration
SESSION_ENABLE_PERFORMANCE_MONITORING=true
SESSION_ENABLE_METRICS_COLLECTION=true
SESSION_ENABLE_HEALTH_CHECKS=true
SESSION_METRICS_INTERVAL_SECONDS=60
SESSION_HEALTH_CHECK_INTERVAL_SECONDS=300
SESSION_METRICS_BUFFER_SIZE=1000
SESSION_EVENTS_BUFFER_SIZE=500

# Session Alert Thresholds
SESSION_ALERT_CREATION_RATE=100.0
SESSION_ALERT_FAILURE_RATE=10.0
SESSION_ALERT_AVG_DURATION=3600.0
SESSION_ALERT_CONCURRENT_SESSIONS=1000.0
SESSION_ALERT_SUSPICIOUS_RATE=5.0

# Session Feature Flags
SESSION_FEATURE_CROSS_TAB_SYNC=true
SESSION_FEATURE_PLATFORM_SWITCHING=true
SESSION_FEATURE_PERSISTENCE=true
SESSION_FEATURE_OPTIMISTIC_UI=true
SESSION_FEATURE_BACKGROUND_CLEANUP=true
SESSION_FEATURE_ANALYTICS=true
SESSION_FEATURE_CLUSTERING=false
SESSION_FEATURE_DISTRIBUTED=false
SESSION_FEATURE_CACHING=false

# =============================================================================
# STORAGE AND LOGGING
# =============================================================================

# Storage Configuration
STORAGE_BASE_DIR=storage
STORAGE_IMAGES_DIR=storage/images
STORAGE_DATABASE_DIR=storage/database
LOGS_DIR=logs

# Logging Configuration
LOG_LEVEL=INFO

# Data Retention Configuration (in days)
RETENTION_PROCESSING_RUNS=90
RETENTION_REJECTED_IMAGES=30
RETENTION_POSTED_IMAGES=180
RETENTION_ERROR_IMAGES=60

# =============================================================================
# SECURITY FEATURE TOGGLES (Development/Testing Only)
# =============================================================================

# CSRF Protection
SECURITY_CSRF_ENABLED=false

# Rate Limiting
SECURITY_RATE_LIMITING_ENABLED=false

# Input Validation and Sanitization
SECURITY_INPUT_VALIDATION_ENABLED=false

# Security Headers
SECURITY_HEADERS_ENABLED=true

# Session Security Validation
SECURITY_SESSION_VALIDATION_ENABLED=true

# Admin Access Control
SECURITY_ADMIN_CHECKS_ENABLED=true

# =============================================================================
# EMAIL CONFIGURATION
# =============================================================================

# Email Configuration (for user notifications)
MAIL_SERVER=sandbox.smtp.mailtrap.io
MAIL_PORT=587
MAIL_USE_TLS=True
MAIL_USERNAME=24cc1476b47de6
MAIL_PASSWORD=7be97c03d858ab
MAIL_DEFAULT_SENDER=iolaire@vedfolnir.org

# =============================================================================
# PLATFORM CONNECTIONS
# =============================================================================
# Platform-specific settings (URLs, tokens, credentials) are now managed
# through the web interface for better security and ease of use.
#
# To configure platform connections:
# 1. Start the web application: python web_app.py
# 2. Go to Platform Management in the web interface
# 3. Click "Add Platform" to configure your connections
# 4. Enter your platform details and credentials
# 5. Test the connection to ensure it works
#
# Supported platforms:
# - Pixelfed: Requires instance URL, username, and access token
# - Mastodon: Requires instance URL, username, access token, and OAuth credentials
#
# All credentials are encrypted and stored securely in the MySQL database.
# No platform credentials should be stored in this .env file.

# SECURITY WARNING: 
# - Copy this file to .env and replace ALL example values with secure, unique values
# - The .env file is gitignored and should never be committed to version control
# - See docs/security/environment-setup.md for detailed setup instructions
# - Use the provided scripts in scripts/setup/ to generate secure values automatically
