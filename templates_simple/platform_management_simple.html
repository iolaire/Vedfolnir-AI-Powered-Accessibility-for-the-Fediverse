{% extends "base_simple.html" %}

{% block title %}Platform Management - Vedfolnir{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h4>Platform Management</h4>
            </div>
            <div class="card-body">
                {% if platforms %}
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Instance URL</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for platform in platforms %}
                                <tr class="{{ 'table-primary' if platform.id == current_platform_id else '' }}">
                                    <td>
                                        {{ platform.name }}
                                        {% if platform.is_default %}
                                            <span class="badge bg-secondary">Default</span>
                                        {% endif %}
                                        {% if platform.id == current_platform_id %}
                                            <span class="badge bg-primary">Current</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ platform.platform_type }}</td>
                                    <td>{{ platform.instance_url }}</td>
                                    <td>
                                        {% if platform.is_active %}
                                            <span class="badge bg-success">Active</span>
                                        {% else %}
                                            <span class="badge bg-danger">Inactive</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if platform.id != current_platform_id %}
                                            <a href="{{ url_for('switch_platform', platform_id=platform.id) }}" 
                                               class="btn btn-sm btn-primary">Switch</a>
                                        {% else %}
                                            <span class="text-muted">Current</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="alert alert-info">
                        <h5>No Platforms Configured</h5>
                        <p>You don't have any platform connections set up yet. Platform connections would normally be added through the full application interface.</p>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h5>Session Context</h5>
            </div>
            <div class="card-body">
                <p>The current platform context is stored in your Redis session:</p>
                <ul>
                    <li><strong>Current Platform ID:</strong> {{ current_platform_id or 'None' }}</li>
                    <li><strong>Session Storage:</strong> Redis</li>
                    <li><strong>Cookie Management:</strong> Flask</li>
                </ul>
                
                <p class="text-muted small">
                    When you switch platforms, the platform ID is updated in your Redis session data.
                    The session cookie remains the same, but the data associated with your session ID in Redis is updated.
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
