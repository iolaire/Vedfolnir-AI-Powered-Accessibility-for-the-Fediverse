# WebSocket Production Configuration Example
# Copy this file to .env and configure for your production environment

# =============================================================================
# PRODUCTION MODE SETTINGS
# =============================================================================

# Enable production mode (required for production features)
WEBSOCKET_PRODUCTION_MODE=true

# Disable debug mode in production
WEBSOCKET_DEBUG_MODE=false

# Enable enhanced security features
WEBSOCKET_ENHANCED_SECURITY=true

# Enable security headers
WEBSOCKET_SECURITY_HEADERS=true

# =============================================================================
# SSL/TLS CONFIGURATION
# =============================================================================

# SSL Certificate Files (required for WSS)
WEBSOCKET_SSL_CERT_FILE=/path/to/ssl/certificate.pem
WEBSOCKET_SSL_KEY_FILE=/path/to/ssl/private_key.pem
WEBSOCKET_SSL_CA_FILE=/path/to/ssl/ca_bundle.pem
WEBSOCKET_SSL_CERT_CHAIN_FILE=/path/to/ssl/cert_chain.pem

# SSL Protocol Configuration
WEBSOCKET_SSL_VERSION=TLSv1_2
WEBSOCKET_SSL_CIPHERS=ECDHE+AESGCM:ECDHE+CHACHA20:DHE+AESGCM:DHE+CHACHA20:!aNULL:!MD5:!DSS
WEBSOCKET_SSL_VERIFY_MODE=CERT_NONE
WEBSOCKET_SSL_CHECK_HOSTNAME=false

# SSL Security Options
WEBSOCKET_SSL_VALIDATE_CERTS=true
WEBSOCKET_SSL_ALLOW_SELF_SIGNED=false

# HTTPS Enforcement
WEBSOCKET_FORCE_HTTPS=true
WEBSOCKET_HTTPS_REDIRECT=true

# HTTP Strict Transport Security (HSTS)
WEBSOCKET_HSTS_ENABLED=true
WEBSOCKET_HSTS_MAX_AGE=31536000
WEBSOCKET_HSTS_INCLUDE_SUBDOMAINS=true

# =============================================================================
# LOAD BALANCER CONFIGURATION
# =============================================================================

# Session Affinity
WEBSOCKET_SESSION_AFFINITY=true
WEBSOCKET_SESSION_AFFINITY_COOKIE=WEBSOCKET_SERVER
WEBSOCKET_SESSION_AFFINITY_TIMEOUT=3600

# Health Check Configuration
WEBSOCKET_HEALTH_CHECK_PATH=/websocket/health
WEBSOCKET_HEALTH_CHECK_INTERVAL=30
WEBSOCKET_HEALTH_CHECK_TIMEOUT=5
WEBSOCKET_HEALTH_CHECK_RETRIES=3

# Proxy Headers (for load balancers)
WEBSOCKET_TRUST_PROXY_HEADERS=true
WEBSOCKET_PROXY_HEADERS=X-Forwarded-For,X-Forwarded-Proto,X-Forwarded-Host,X-Real-IP

# Connection Limits
WEBSOCKET_MAX_CONNECTIONS_PER_SERVER=1000
WEBSOCKET_CONNECTION_TIMEOUT=30

# Sticky Sessions
WEBSOCKET_STICKY_SESSIONS=true
WEBSOCKET_STICKY_SESSION_KEY=websocket_server_id

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log Levels
WEBSOCKET_LOG_LEVEL=WARNING
WEBSOCKET_SECURITY_LOG_LEVEL=WARNING
WEBSOCKET_PERFORMANCE_LOG_LEVEL=WARNING
WEBSOCKET_ERROR_LOG_LEVEL=ERROR

# Log Format
WEBSOCKET_LOG_FORMAT=%(asctime)s - %(name)s - %(levelname)s - %(message)s
WEBSOCKET_JSON_LOGGING=true
WEBSOCKET_STRUCTURED_LOGGING=true

# Log Files
WEBSOCKET_LOG_FILE=/var/log/vedfolnir/websocket.log
WEBSOCKET_SECURITY_LOG_FILE=/var/log/vedfolnir/websocket_security.log
WEBSOCKET_PERFORMANCE_LOG_FILE=/var/log/vedfolnir/websocket_performance.log
WEBSOCKET_ERROR_LOG_FILE=/var/log/vedfolnir/websocket_errors.log

# Log Rotation
WEBSOCKET_LOG_ROTATION=true
WEBSOCKET_MAX_LOG_SIZE=100MB
WEBSOCKET_LOG_BACKUP_COUNT=10

# Remote Logging
WEBSOCKET_REMOTE_LOGGING=false
WEBSOCKET_SYSLOG_SERVER=syslog.example.com:514
WEBSOCKET_LOG_AGGREGATION_SERVICE=https://logs.example.com/api/ingest

# =============================================================================
# MONITORING CONFIGURATION
# =============================================================================

# Metrics Collection
WEBSOCKET_METRICS_ENABLED=true
WEBSOCKET_METRICS_ENDPOINT=/websocket/metrics
WEBSOCKET_METRICS_FORMAT=prometheus

# Performance Monitoring
WEBSOCKET_PERFORMANCE_MONITORING=true
WEBSOCKET_CONNECTION_METRICS=true
WEBSOCKET_MESSAGE_METRICS=true
WEBSOCKET_ERROR_METRICS=true

# Health Checks
WEBSOCKET_HEALTH_CHECKS=true
WEBSOCKET_HEALTH_ENDPOINT=/websocket/health
WEBSOCKET_DETAILED_HEALTH=true

# Alerting
WEBSOCKET_ALERTING_ENABLED=true
WEBSOCKET_ALERT_WEBHOOK_URL=https://alerts.example.com/webhook
WEBSOCKET_ALERT_THRESHOLDS={"connection_errors":10,"message_errors":50,"response_time_ms":1000,"memory_usage_mb":500}

# =============================================================================
# BACKUP AND RECOVERY CONFIGURATION
# =============================================================================

# State Backup
WEBSOCKET_STATE_BACKUP=true
WEBSOCKET_BACKUP_INTERVAL=300
WEBSOCKET_BACKUP_LOCATION=/var/backups/vedfolnir/websocket
WEBSOCKET_MAX_BACKUP_FILES=24

# Recovery Configuration
WEBSOCKET_AUTO_RECOVERY=true
WEBSOCKET_RECOVERY_TIMEOUT=30
WEBSOCKET_RECOVERY_RETRIES=3

# State Persistence
WEBSOCKET_PERSIST_CONNECTIONS=true
WEBSOCKET_PERSIST_SUBSCRIPTIONS=true
WEBSOCKET_PERSIST_SESSION_DATA=true

# Backup Compression
WEBSOCKET_COMPRESS_BACKUPS=true
WEBSOCKET_COMPRESSION_LEVEL=6

# =============================================================================
# PERFORMANCE OPTIMIZATION
# =============================================================================

# Connection Management
WEBSOCKET_CONNECTION_POOLING=true
WEBSOCKET_MESSAGE_COMPRESSION=true
WEBSOCKET_KEEP_ALIVE=true

# Transport Configuration (Final Working Configuration)
SOCKETIO_TRANSPORTS=websocket,polling
SOCKETIO_PING_TIMEOUT=60
SOCKETIO_PING_INTERVAL=25
SOCKETIO_ASYNC_MODE=threading

# Client Configuration
SOCKETIO_RECONNECTION=true
SOCKETIO_RECONNECTION_ATTEMPTS=5
SOCKETIO_RECONNECTION_DELAY=1000
SOCKETIO_RECONNECTION_DELAY_MAX=5000
SOCKETIO_TIMEOUT=20000
SOCKETIO_FORCE_NEW=false
SOCKETIO_UPGRADE=true
SOCKETIO_REMEMBER_UPGRADE=true
SOCKETIO_WITH_CREDENTIALS=true

# Performance Configuration
SOCKETIO_MAX_CONNECTIONS=1000
SOCKETIO_CONNECTION_POOL_SIZE=10
SOCKETIO_MAX_HTTP_BUFFER_SIZE=1000000

# =============================================================================
# CORS CONFIGURATION
# =============================================================================

# CORS Origins (auto-generated from FLASK_HOST/FLASK_PORT if not set)
# SOCKETIO_CORS_ORIGINS=https://yourdomain.com,https://www.yourdomain.com

# CORS Settings (Final Working Configuration)
SOCKETIO_CORS_CREDENTIALS=true
SOCKETIO_CORS_METHODS=GET,POST
SOCKETIO_CORS_HEADERS=Content-Type,Authorization

# =============================================================================
# REDIS CONFIGURATION (for coordination)
# =============================================================================

# Redis Connection
REDIS_URL=redis://localhost:6379/0
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=your_redis_password
REDIS_SSL=false

# Redis Session Configuration
REDIS_SESSION_PREFIX=vedfolnir:session:
REDIS_SESSION_TIMEOUT=7200

# =============================================================================
# FLASK CONFIGURATION
# =============================================================================

# Flask Host and Port (used for CORS origin generation)
FLASK_HOST=yourdomain.com
FLASK_PORT=443

# Flask Environment
FLASK_ENV=production
FLASK_DEBUG=false

# Session Configuration
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_SAMESITE=Lax

# =============================================================================
# EXAMPLE CONFIGURATIONS FOR DIFFERENT ENVIRONMENTS
# =============================================================================

# Development Environment Example:
# WEBSOCKET_PRODUCTION_MODE=false
# WEBSOCKET_DEBUG_MODE=true
# WEBSOCKET_SSL_CERT_FILE=
# WEBSOCKET_SSL_KEY_FILE=
# WEBSOCKET_FORCE_HTTPS=false
# WEBSOCKET_LOG_LEVEL=WARNING
# FLASK_HOST=localhost
# FLASK_PORT=5000

# Staging Environment Example:
# WEBSOCKET_PRODUCTION_MODE=true
# WEBSOCKET_DEBUG_MODE=false
# WEBSOCKET_SSL_CERT_FILE=/etc/ssl/staging/cert.pem
# WEBSOCKET_SSL_KEY_FILE=/etc/ssl/staging/key.pem
# WEBSOCKET_FORCE_HTTPS=true
# WEBSOCKET_LOG_LEVEL=WARNING
# FLASK_HOST=staging.yourdomain.com
# FLASK_PORT=443

# Production Environment Example:
# WEBSOCKET_PRODUCTION_MODE=true
# WEBSOCKET_DEBUG_MODE=false
# WEBSOCKET_SSL_CERT_FILE=/etc/ssl/production/cert.pem
# WEBSOCKET_SSL_KEY_FILE=/etc/ssl/production/key.pem
# WEBSOCKET_FORCE_HTTPS=true
# WEBSOCKET_LOG_LEVEL=WARNING
# WEBSOCKET_ALERTING_ENABLED=true
# FLASK_HOST=yourdomain.com
# FLASK_PORT=443

# =============================================================================
# KUBERNETES/DOCKER CONFIGURATION
# =============================================================================

# For Kubernetes deployments, you may want to use:
# WEBSOCKET_HEALTH_CHECK_PATH=/healthz
# WEBSOCKET_METRICS_ENDPOINT=/metrics
# WEBSOCKET_LOG_LEVEL=WARNING
# WEBSOCKET_JSON_LOGGING=true

# For Docker Swarm deployments, you may want to use:
# WEBSOCKET_SESSION_AFFINITY=true
# WEBSOCKET_STICKY_SESSIONS=true
# WEBSOCKET_TRUST_PROXY_HEADERS=true

# =============================================================================
# SECURITY CONSIDERATIONS
# =============================================================================

# 1. Always use HTTPS in production (WEBSOCKET_FORCE_HTTPS=true)
# 2. Use strong SSL/TLS configuration (TLSv1.2 or higher)
# 3. Enable HSTS headers (WEBSOCKET_HSTS_ENABLED=true)
# 4. Use secure session cookies (SESSION_COOKIE_SECURE=true)
# 5. Enable security headers (WEBSOCKET_SECURITY_HEADERS=true)
# 6. Configure proper CORS origins (don't use wildcards in production)
# 7. Enable alerting for security events (WEBSOCKET_ALERTING_ENABLED=true)
# 8. Use strong Redis passwords if Redis is exposed
# 9. Regularly rotate SSL certificates
# 10. Monitor security logs and set up alerts

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================

# For high-traffic deployments, consider:
# WEBSOCKET_MAX_CONNECTIONS_PER_SERVER=2000
# SOCKETIO_MAX_HTTP_BUFFER_SIZE=2000000
# WEBSOCKET_MESSAGE_COMPRESSION=true
# WEBSOCKET_CONNECTION_POOLING=true
# SOCKETIO_ASYNC_MODE=eventlet  # or gevent for better performance

# For low-latency requirements:
# SOCKETIO_PING_INTERVAL=10
# SOCKETIO_PING_TIMEOUT=30
# WEBSOCKET_CONNECTION_TIMEOUT=15

# For memory-constrained environments:
# WEBSOCKET_MAX_BACKUP_FILES=5
# WEBSOCKET_COMPRESS_BACKUPS=true
# WEBSOCKET_COMPRESSION_LEVEL=9