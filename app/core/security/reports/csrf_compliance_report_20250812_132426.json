{
  "metadata": {
    "generated_at": "2025-08-12T13:24:26.888468",
    "total_templates_scanned": 30,
    "scan_version": "1.0.0"
  },
  "summary": {
    "total_templates": 30,
    "templates_with_forms": 12,
    "csrf_protected_templates": 6,
    "protection_rate": 50.0,
    "overall_compliance_score": 0.8058823529411764,
    "total_issues": 18,
    "critical_issues": 0,
    "high_issues": 10,
    "medium_issues": 7,
    "low_issues": 1
  },
  "compliance_levels": {
    "excellent": 8,
    "good": 2,
    "needs_improvement": 0,
    "poor": 2
  },
  "issues_analysis": {
    "by_severity": {
      "CRITICAL": 0,
      "HIGH": 10,
      "MEDIUM": 7,
      "LOW": 1
    },
    "by_type": {
      "ajax_csrf_missing": 9,
      "token_exposure": 8,
      "csrf_method": 1
    },
    "most_common_issues": [
      [
        "ajax_csrf_missing",
        9
      ],
      [
        "token_exposure",
        8
      ],
      [
        "csrf_method",
        1
      ]
    ]
  },
  "recommendations": [
    "Ensure all state-changing forms have CSRF protection",
    "Review and fix CSRF token exposure issues"
  ],
  "templates": [
    {
      "path": "templates/review_batches.html",
      "has_forms": true,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/profile.html",
      "has_forms": true,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 0.20000000000000007,
      "issue_count": 4,
      "critical_issues": 0,
      "high_issues": 4,
      "issues": [
        {
          "template_path": "templates/profile.html",
          "issue_type": "ajax_csrf_missing",
          "severity": "HIGH",
          "description": "AJAX fetch post request missing CSRF header",
          "line_number": 329,
          "code_snippet": "Fetch(`/api/switch_platform/${platformId}`, {\n            method: 'POST'",
          "recommendation": "Add X-CSRFToken header with token from meta tag"
        },
        {
          "template_path": "templates/profile.html",
          "issue_type": "ajax_csrf_missing",
          "severity": "HIGH",
          "description": "AJAX fetch post request missing CSRF header",
          "line_number": 359,
          "code_snippet": "Fetch(`/api/test_platform/${platformId}`, {\n            method: 'POST'",
          "recommendation": "Add X-CSRFToken header with token from meta tag"
        },
        {
          "template_path": "templates/profile.html",
          "issue_type": "ajax_csrf_missing",
          "severity": "HIGH",
          "description": "AJAX fetch post request missing CSRF header",
          "line_number": 387,
          "code_snippet": "Fetch(`/api/sessions/${sessionId}`, {\n            method: 'DELETE'",
          "recommendation": "Add X-CSRFToken header with token from meta tag"
        },
        {
          "template_path": "templates/profile.html",
          "issue_type": "ajax_csrf_missing",
          "severity": "HIGH",
          "description": "AJAX fetch post request missing CSRF header",
          "line_number": 437,
          "code_snippet": "Fetch('/api/update_user_settings', {\n            method: 'POST'",
          "recommendation": "Add X-CSRFToken header with token from meta tag"
        }
      ]
    },
    {
      "path": "templates/index.html",
      "has_forms": false,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/caption_settings.html",
      "has_forms": true,
      "csrf_protected": true,
      "csrf_method": "hidden_tag",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/review.html",
      "has_forms": false,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/first_time_setup.html",
      "has_forms": false,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/base.html",
      "has_forms": false,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 2,
      "critical_issues": 0,
      "high_issues": 2,
      "issues": [
        {
          "template_path": "templates/base.html",
          "issue_type": "token_exposure",
          "severity": "HIGH",
          "description": "CSRF token potentially exposed in comment",
          "line_number": 2,
          "code_snippet": "<!-- Copyright (C) 2025 iolaire mcfadden. -->\n<!-- This program is free software: you can redistribu...",
          "recommendation": "Use meta tag for JavaScript access: <meta name=\"csrf-token\" content=\"{{ csrf_token() }}\">"
        },
        {
          "template_path": "templates/base.html",
          "issue_type": "ajax_csrf_missing",
          "severity": "HIGH",
          "description": "AJAX fetch post request missing CSRF header",
          "line_number": 333,
          "code_snippet": "Fetch(`/api/switch_platform/${platformId}`, {\n                    method: 'POST'",
          "recommendation": "Add X-CSRFToken header with token from meta tag"
        }
      ]
    },
    {
      "path": "templates/admin_monitoring.html",
      "has_forms": false,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/review_batch.html",
      "has_forms": true,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/500.html",
      "has_forms": false,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/404.html",
      "has_forms": false,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/login.html",
      "has_forms": true,
      "csrf_protected": true,
      "csrf_method": "hidden_tag",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/review_single.html",
      "has_forms": true,
      "csrf_protected": true,
      "csrf_method": "hidden_tag",
      "compliance_score": 0.7000000000000001,
      "issue_count": 2,
      "critical_issues": 0,
      "high_issues": 2,
      "issues": [
        {
          "template_path": "templates/review_single.html",
          "issue_type": "ajax_csrf_missing",
          "severity": "HIGH",
          "description": "AJAX fetch post request missing CSRF header",
          "line_number": 313,
          "code_snippet": "Fetch(`/api/regenerate_caption/${imageId}`, {\n                    method: 'POST'",
          "recommendation": "Add X-CSRFToken header with token from meta tag"
        },
        {
          "template_path": "templates/review_single.html",
          "issue_type": "ajax_csrf_missing",
          "severity": "HIGH",
          "description": "AJAX fetch post request missing CSRF header",
          "line_number": 381,
          "code_snippet": "Fetch(`/api/update_caption/${imageId}`, {\n                    method: 'POST'",
          "recommendation": "Add X-CSRFToken header with token from meta tag"
        }
      ]
    },
    {
      "path": "templates/platform_management.html",
      "has_forms": true,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/health_dashboard.html",
      "has_forms": false,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/user_management.html",
      "has_forms": true,
      "csrf_protected": true,
      "csrf_method": "hidden_tag",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/batch_review.html",
      "has_forms": true,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/admin_cleanup.html",
      "has_forms": true,
      "csrf_protected": true,
      "csrf_method": "csrf_token",
      "compliance_score": 0.2500000000000001,
      "issue_count": 8,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": [
        {
          "template_path": "templates/admin_cleanup.html",
          "issue_type": "csrf_method",
          "severity": "LOW",
          "description": "Template uses csrf_token() instead of recommended form.hidden_tag()",
          "line_number": null,
          "code_snippet": null,
          "recommendation": "Replace csrf_token() with form.hidden_tag() for better security"
        },
        {
          "template_path": "templates/admin_cleanup.html",
          "issue_type": "token_exposure",
          "severity": "MEDIUM",
          "description": "CSRF token potentially exposed in visible div",
          "line_number": 9,
          "code_snippet": "<div class=\"container mt-4\">\n    <h1>Data Cleanup</h1>\n    \n    <div class=\"alert alert-info\">\n     ...",
          "recommendation": "Use meta tag for JavaScript access: <meta name=\"csrf-token\" content=\"{{ csrf_token() }}\">"
        },
        {
          "template_path": "templates/admin_cleanup.html",
          "issue_type": "token_exposure",
          "severity": "MEDIUM",
          "description": "CSRF token potentially exposed in visible div",
          "line_number": 128,
          "code_snippet": "<div class=\"form-check mb-3\">\n                    <input class=\"form-check-input\" type=\"checkbox\" id...",
          "recommendation": "Use meta tag for JavaScript access: <meta name=\"csrf-token\" content=\"{{ csrf_token() }}\">"
        },
        {
          "template_path": "templates/admin_cleanup.html",
          "issue_type": "token_exposure",
          "severity": "MEDIUM",
          "description": "CSRF token potentially exposed in visible div",
          "line_number": 152,
          "code_snippet": "<div class=\"form-check mb-3\">\n                    <input class=\"form-check-input\" type=\"checkbox\" id...",
          "recommendation": "Use meta tag for JavaScript access: <meta name=\"csrf-token\" content=\"{{ csrf_token() }}\">"
        },
        {
          "template_path": "templates/admin_cleanup.html",
          "issue_type": "token_exposure",
          "severity": "MEDIUM",
          "description": "CSRF token potentially exposed in visible div",
          "line_number": 185,
          "code_snippet": "<div class=\"mb-3\">\n                    <label for=\"images_days\" class=\"form-label\">Clean up images o...",
          "recommendation": "Use meta tag for JavaScript access: <meta name=\"csrf-token\" content=\"{{ csrf_token() }}\">"
        },
        {
          "template_path": "templates/admin_cleanup.html",
          "issue_type": "token_exposure",
          "severity": "MEDIUM",
          "description": "CSRF token potentially exposed in visible div",
          "line_number": 218,
          "code_snippet": "<div class=\"card mb-4\">\n        <div class=\"card-header\">\n            <h2 class=\"h5 mb-0\">Clean Up U...",
          "recommendation": "Use meta tag for JavaScript access: <meta name=\"csrf-token\" content=\"{{ csrf_token() }}\">"
        },
        {
          "template_path": "templates/admin_cleanup.html",
          "issue_type": "token_exposure",
          "severity": "MEDIUM",
          "description": "CSRF token potentially exposed in visible div",
          "line_number": 234,
          "code_snippet": "<div class=\"form-check mb-3\">\n                    <input class=\"form-check-input\" type=\"checkbox\" id...",
          "recommendation": "Use meta tag for JavaScript access: <meta name=\"csrf-token\" content=\"{{ csrf_token() }}\">"
        },
        {
          "template_path": "templates/admin_cleanup.html",
          "issue_type": "token_exposure",
          "severity": "MEDIUM",
          "description": "CSRF token potentially exposed in visible span",
          "line_number": 36,
          "code_snippet": "<span class=\"badge bg-primary ms-2\">{{ active_platform.platform_type|title }}</span>\n               ...",
          "recommendation": "Use meta tag for JavaScript access: <meta name=\"csrf-token\" content=\"{{ csrf_token() }}\">"
        }
      ]
    },
    {
      "path": "templates/caption_generation.html",
      "has_forms": true,
      "csrf_protected": true,
      "csrf_method": "hidden_tag",
      "compliance_score": 0.7000000000000001,
      "issue_count": 2,
      "critical_issues": 0,
      "high_issues": 2,
      "issues": [
        {
          "template_path": "templates/caption_generation.html",
          "issue_type": "ajax_csrf_missing",
          "severity": "HIGH",
          "description": "AJAX fetch post request missing CSRF header",
          "line_number": 504,
          "code_snippet": "Fetch(this.action, {\n        method: 'POST'",
          "recommendation": "Add X-CSRFToken header with token from meta tag"
        },
        {
          "template_path": "templates/caption_generation.html",
          "issue_type": "ajax_csrf_missing",
          "severity": "HIGH",
          "description": "AJAX fetch post request missing CSRF header",
          "line_number": 541,
          "code_snippet": "Fetch(`/api/caption_generation/cancel/${taskId}`, {\n        method: 'POST'",
          "recommendation": "Add X-CSRFToken header with token from meta tag"
        }
      ]
    },
    {
      "path": "templates/includes/favicon_meta.html",
      "has_forms": false,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/admin/session_monitoring_dashboard.html",
      "has_forms": false,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/components/add_platform_modal.html",
      "has_forms": true,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/errors/403.html",
      "has_forms": false,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/errors/429.html",
      "has_forms": false,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/errors/500.html",
      "has_forms": false,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/errors/404.html",
      "has_forms": false,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/errors/session_error.html",
      "has_forms": false,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/errors/csrf_error.html",
      "has_forms": false,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/errors/401.html",
      "has_forms": false,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    },
    {
      "path": "templates/errors/400.html",
      "has_forms": false,
      "csrf_protected": false,
      "csrf_method": "none",
      "compliance_score": 1.0,
      "issue_count": 0,
      "critical_issues": 0,
      "high_issues": 0,
      "issues": []
    }
  ]
}