# Copyright (C) 2025 iolaire mcfadden.
# This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

# Redis Environment Configuration for Vedfolnir Docker Deployment
# Session storage and RQ queue optimization settings

# Memory Management
REDIS_MAXMEMORY=1gb
REDIS_MAXMEMORY_POLICY=volatile-lru
REDIS_MAXMEMORY_SAMPLES=10

# Persistence Configuration
REDIS_SAVE_POLICY=900 1 300 10 60 10000 30 100000
REDIS_AOF_ENABLED=yes
REDIS_AOF_FSYNC=everysec
REDIS_AOF_REWRITE_PERCENTAGE=100
REDIS_AOF_REWRITE_MIN_SIZE=64mb

# Session Storage Optimization
REDIS_SESSION_PREFIX=vedfolnir:session:
REDIS_SESSION_TIMEOUT=7200
REDIS_SESSION_CLEANUP_INTERVAL=3600

# RQ Queue Configuration
REDIS_RQ_PREFIX=rq:
REDIS_RQ_DEFAULT_TIMEOUT=300
REDIS_RQ_RESULT_TTL=86400
REDIS_RQ_JOB_TTL=7200

# Network Configuration
REDIS_BIND=0.0.0.0
REDIS_PORT=6379
REDIS_TCP_BACKLOG=511
REDIS_TCP_KEEPALIVE=60
REDIS_TIMEOUT=300

# Security Configuration
REDIS_PROTECTED_MODE=yes
REDIS_MAXCLIENTS=10000

# Performance Tuning
REDIS_HASH_MAX_ZIPLIST_ENTRIES=1024
REDIS_HASH_MAX_ZIPLIST_VALUE=256
REDIS_LIST_MAX_ZIPLIST_SIZE=-1
REDIS_SET_MAX_INTSET_ENTRIES=1024

# Monitoring Configuration
REDIS_SLOWLOG_LOG_SLOWER_THAN=10000
REDIS_SLOWLOG_MAX_LEN=128
REDIS_LATENCY_MONITOR_THRESHOLD=100

# Keyspace Notifications (for session expiration tracking)
REDIS_NOTIFY_KEYSPACE_EVENTS=Ex

# Memory Defragmentation
REDIS_ACTIVEDEFRAG=yes
REDIS_ACTIVE_DEFRAG_IGNORE_BYTES=100mb
REDIS_ACTIVE_DEFRAG_THRESHOLD_LOWER=10
REDIS_ACTIVE_DEFRAG_THRESHOLD_UPPER=100

# Logging Configuration
REDIS_LOGLEVEL=notice
REDIS_LOGFILE=""
REDIS_SYSLOG_ENABLED=no

# Client Output Buffer Limits
REDIS_CLIENT_OUTPUT_BUFFER_LIMIT_NORMAL=0 0 0
REDIS_CLIENT_OUTPUT_BUFFER_LIMIT_REPLICA=256mb 64mb 60
REDIS_CLIENT_OUTPUT_BUFFER_LIMIT_PUBSUB=32mb 8mb 60

# Lua Scripting
REDIS_LUA_TIME_LIMIT=5000

# Replication (for future scaling)
REDIS_REPLICA_SERVE_STALE_DATA=yes
REDIS_REPLICA_READ_ONLY=yes
REDIS_REPL_DISKLESS_SYNC=no
REDIS_REPL_DISKLESS_SYNC_DELAY=5

# Background Operations
REDIS_HZ=10
REDIS_DYNAMIC_HZ=yes
REDIS_AOF_REWRITE_INCREMENTAL_FSYNC=yes
REDIS_RDB_SAVE_INCREMENTAL_FSYNC=yes

# Jemalloc Configuration
REDIS_JEMALLOC_BG_THREAD=yes

# Container-specific settings
REDIS_DAEMONIZE=no
REDIS_SUPERVISED=no
REDIS_PIDFILE=/var/run/redis_6379.pid
REDIS_DIR=/data
REDIS_DBFILENAME=dump.rdb
REDIS_APPENDFILENAME=appendonly.aof