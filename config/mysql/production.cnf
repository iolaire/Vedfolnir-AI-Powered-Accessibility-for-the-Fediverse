# Copyright (C) 2025 iolaire mcfadden.
# This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

# MariaDB Production Configuration for Vedfolnir Docker container
# Optimized for production performance, security, and reliability

[mysqld]
# Basic settings
user = mysql
port = 3306
datadir = /var/lib/mysql

# Character set and collation
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# Storage engine
default-storage-engine = InnoDB

# Connection settings (production optimized)
max_connections = 500
max_allowed_packet = 64M
interactive_timeout = 600
wait_timeout = 600
connect_timeout = 10

# InnoDB settings (production optimized)
innodb_buffer_pool_size = 2G
innodb_buffer_pool_instances = 8
innodb_file_per_table = 1
innodb_flush_log_at_trx_commit = 1
innodb_log_buffer_size = 64M
innodb_log_file_size = 512M
innodb_flush_method = O_DIRECT
innodb_io_capacity = 2000
innodb_io_capacity_max = 4000

# Query cache (disabled for production performance)
query_cache_type = 0
query_cache_size = 0

# Binary logging (production)
log-bin = mysql-bin
binlog_format = ROW
expire_logs_days = 30
sync_binlog = 1

# Error logging
log-error = /var/log/mysql/error.log
log_error_verbosity = 2

# Slow query logging
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 1

# General query logging (disabled for production)
general_log = 0

# Security settings
skip-name-resolve
local-infile = 0

# Performance optimizations
tmp_table_size = 256M
max_heap_table_size = 256M
sort_buffer_size = 4M
read_buffer_size = 2M
read_rnd_buffer_size = 8M
join_buffer_size = 4M

# Thread settings
thread_cache_size = 100
thread_stack = 256K

# Table settings
table_definition_cache = 8000
table_open_cache = 8000
table_open_cache_instances = 16

# MariaDB specific optimizations
innodb_adaptive_hash_index = 1
innodb_change_buffering = all
innodb_old_blocks_time = 1000
innodb_read_io_threads = 8
innodb_write_io_threads = 8

[mysql]
default-character-set = utf8mb4

[client]
default-character-set = utf8mb4