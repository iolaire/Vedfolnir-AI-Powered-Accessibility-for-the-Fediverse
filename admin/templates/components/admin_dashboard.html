<!-- Copyright (C) 2025 iolaire mcfadden. -->
<!-- This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. -->
<!-- THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE. -->

<!-- Admin Dashboard Component -->
<!-- Requirements: 1.2, 1.3, 1.4, 1.5 -->

<div class="admin-dashboard">
    <!-- Welcome Section -->
    <div class="dashboard-header">
        <h1 class="dashboard-title">Administrator Dashboard</h1>
        <p class="dashboard-subtitle">System overview and management controls</p>
    </div>

    <!-- System Status Cards -->
    <div class="status-grid">
        <div class="status-card system-health">
            <div class="status-icon">
                <i class="icon-health" aria-hidden="true"></i>
            </div>
            <div class="status-content">
                <div class="status-title">System Health</div>
                <div class="status-value" id="system-health-status">
                    Loading...
                </div>
                <div class="status-subtitle" id="system-health-details">
                    Checking system components...
                </div>
            </div>
            <div class="status-action">
                <a href="{{ url_for('admin.health_dashboard') }}" class="btn btn-sm btn-outline-primary">Details</a>
            </div>
        </div>

        <div class="status-card user-stats">
            <div class="status-icon">
                <i class="icon-users" aria-hidden="true"></i>
            </div>
            <div class="status-content">
                <div class="status-title">Total Users</div>
                <div class="status-value">{{ stats.total_users or 0 }}</div>
                <div class="status-subtitle">{{ stats.active_users or 0 }} active</div>
            </div>
            <div class="status-action">
                <a href="{{ url_for('admin.user_management') }}" class="btn btn-sm btn-primary">Manage</a>
            </div>
        </div>

        <div class="status-card platform-stats">
            <div class="status-icon">
                <i class="icon-platform" aria-hidden="true"></i>
            </div>
            <div class="status-content">
                <div class="status-title">Platforms</div>
                <div class="status-value">{{ stats.total_platforms or 0 }}</div>
                <div class="status-subtitle">Connected</div>
            </div>
            <div class="status-action">
                <a href="{{ url_for('platform_management') }}" class="btn btn-sm btn-primary">Configure</a>
            </div>
        </div>

        <div class="status-card content-stats">
            <div class="status-icon">
                <i class="icon-content" aria-hidden="true"></i>
            </div>
            <div class="status-content">
                <div class="status-title">Images</div>
                <div class="status-value">{{ stats.total_images or 0 }}</div>
                <div class="status-subtitle">{{ stats.total_posts or 0 }} posts</div>
            </div>
            <div class="status-action">
                <a href="{{ url_for('batch_review') }}" class="btn btn-sm btn-primary">Review</a>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <h3>Quick Actions</h3>
        <div class="action-grid">
            <a href="{{ url_for('admin.user_management') }}" class="action-card">
                <i class="icon-user-management" aria-hidden="true"></i>
                <span>User Management</span>
            </a>
            <a href="{{ url_for('admin.health_dashboard') }}" class="action-card">
                <i class="icon-health-dashboard" aria-hidden="true"></i>
                <span>System Health</span>
            </a>
            <a href="{{ url_for('admin.security_audit_dashboard') }}" class="action-card">
                <i class="icon-security" aria-hidden="true"></i>
                <span>Security Audit</span>
            </a>
            <a href="{{ url_for('platform_management') }}" class="action-card">
                <i class="icon-platform-config" aria-hidden="true"></i>
                <span>Platform Config</span>
            </a>
        </div>
    </div>
</div>

<script>
// Admin Dashboard Component JavaScript
(function() {
    'use strict';
    
    // Function to update system health status
    function updateSystemHealth() {
        const statusElement = document.getElementById('system-health-status');
        const detailsElement = document.getElementById('system-health-details');
        
        if (!statusElement || !detailsElement) {
            return; // Elements not found, skip update
        }
        
        // Fetch health status from the same endpoint as admin health dashboard
        fetch('/admin/health')
            .then(response => response.json())
            .then(data => {
                if (data.status) {
                    const status = data.status;
                    const components = data.components || {};
                    
                    // Update status display
                    statusElement.textContent = status.charAt(0).toUpperCase() + status.slice(1);
                    
                    // Set status color class
                    statusElement.className = 'status-value';
                    if (status === 'healthy') {
                        statusElement.classList.add('healthy');
                    } else if (status === 'degraded') {
                        statusElement.classList.add('warning');
                    } else {
                        statusElement.classList.add('critical');
                    }
                    
                    // Update details with component status
                    const componentNames = Object.keys(components);
                    if (componentNames.length > 0) {
                        const healthyComponents = componentNames.filter(name => 
                            components[name] === 'healthy' || 
                            (typeof components[name] === 'string' && !components[name].includes('unhealthy'))
                        );
                        
                        if (healthyComponents.length === componentNames.length) {
                            detailsElement.textContent = `All ${componentNames.length} components healthy`;
                        } else {
                            const unhealthyCount = componentNames.length - healthyComponents.length;
                            detailsElement.textContent = `${healthyComponents.length}/${componentNames.length} components healthy`;
                        }
                    } else {
                        detailsElement.textContent = 'System operational';
                    }
                } else {
                    // Handle error response
                    statusElement.textContent = 'Unknown';
                    statusElement.className = 'status-value warning';
                    detailsElement.textContent = 'Health check failed';
                }
            })
            .catch(error => {
                console.error('Error fetching system health:', error);
                statusElement.textContent = 'Error';
                statusElement.className = 'status-value critical';
                detailsElement.textContent = 'Unable to check health';
            });
    }
    
    // Update system health on page load
    document.addEventListener('DOMContentLoaded', function() {
        updateSystemHealth();
        
        // Set up periodic updates every 30 seconds
        setInterval(updateSystemHealth, 30000);
    });
})();
</script>

<style>
/* Admin Dashboard Component Styles */
.admin-dashboard {
    padding: 1rem;
}

.dashboard-header {
    margin-bottom: 2rem;
    text-align: center;
}

.dashboard-title {
    font-size: 2rem;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 0.5rem;
}

.dashboard-subtitle {
    color: #6c757d;
    font-size: 1.1rem;
}

.status-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.status-card {
    background: white;
    border-radius: 8px;
    padding: 1.5rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    border: 1px solid #e9ecef;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.status-icon {
    font-size: 2rem;
    color: #007bff;
}

.status-content {
    flex: 1;
}

.status-title {
    font-size: 0.9rem;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0.25rem;
}

.status-value {
    font-size: 1.5rem;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 0.25rem;
}

.status-value.healthy {
    color: #28a745;
}

.status-value.warning {
    color: #ffc107;
}

.status-value.critical {
    color: #dc3545;
}

.status-subtitle {
    font-size: 0.85rem;
    color: #6c757d;
}

.status-action {
    margin-left: auto;
}

.quick-actions {
    margin-top: 2rem;
}

.quick-actions h3 {
    margin-bottom: 1rem;
    color: #2c3e50;
}

.action-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.action-card {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    background: white;
    border: 1px solid #e9ecef;
    border-radius: 6px;
    text-decoration: none;
    color: #2c3e50;
    transition: all 0.2s ease;
}

.action-card:hover {
    background: #f8f9fa;
    border-color: #007bff;
    color: #007bff;
    text-decoration: none;
}

.action-card i {
    font-size: 1.25rem;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .status-grid {
        grid-template-columns: 1fr;
    }
    
    .action-grid {
        grid-template-columns: 1fr;
    }
    
    .status-card {
        padding: 1rem;
    }
}
</style>
