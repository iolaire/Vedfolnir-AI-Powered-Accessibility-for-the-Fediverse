<!-- Copyright (C) 2025 iolaire mcfadden. -->
<!-- This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. -->
<!-- THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE. -->

<!-- System Maintenance Modal -->
<div class="modal fade" id="systemMaintenanceModal" tabindex="-1" aria-labelledby="systemMaintenanceModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="systemMaintenanceModalLabel">
                    <i class="bi bi-tools"></i> System Maintenance
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-pause-circle"></i> System Controls
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span>System Status:</span>
                                        <span class="badge bg-success" id="systemStatus">Active</span>
                                    </div>
                                </div>

                                <div class="d-grid gap-2">
                                    <button type="button" class="btn btn-outline-warning" id="pauseSystemBtn"
                                        onclick="pauseSystem()">
                                        <i class="bi bi-pause-circle"></i> Pause New Jobs
                                    </button>
                                    <button type="button" class="btn btn-outline-success" id="resumeSystemBtn"
                                        onclick="resumeSystem()" style="display: none;">
                                        <i class="bi bi-play-circle"></i> Resume System
                                    </button>
                                    <button type="button" class="btn btn-outline-danger" onclick="showEmergencyStop()">
                                        <i class="bi bi-stop-circle"></i> Emergency Stop
                                    </button>
                                </div>

                                <div class="mt-3">
                                    <label for="maintenanceReason" class="form-label">Maintenance Reason</label>
                                    <textarea class="form-control" id="maintenanceReason" rows="3"
                                        placeholder="Enter reason for maintenance..."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-wrench"></i> Maintenance Tasks
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <button type="button" class="btn btn-outline-info" onclick="clearStuckJobs()">
                                        <i class="bi bi-arrow-clockwise"></i> Clear Stuck Jobs
                                    </button>
                                    <button type="button" class="btn btn-outline-warning" onclick="cleanupOldLogs()">
                                        <i class="bi bi-trash"></i> Cleanup Old Logs
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary"
                                        onclick="optimizeDatabase()">
                                        <i class="bi bi-database"></i> Optimize Database
                                    </button>
                                    <button type="button" class="btn btn-outline-primary"
                                        onclick="refreshSystemCache()">
                                        <i class="bi bi-arrow-repeat"></i> Refresh Cache
                                    </button>
                                    <button type="button" class="btn btn-outline-success" onclick="runHealthCheck()">
                                        <i class="bi bi-heart-pulse"></i> Run Health Check
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-activity"></i> Current System Activity
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="h5 text-primary" id="activeJobsCount">0</div>
                                            <small>Active Jobs</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="h5 text-secondary" id="queuedJobsCount">0</div>
                                            <small>Queued Jobs</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="h5 text-info" id="connectedUsersCount">0</div>
                                            <small>Connected Users</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="h5 text-warning" id="systemLoadPercent">0%</div>
                                            <small>System Load</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="bi bi-journal-text"></i> Maintenance Log
                                </h6>
                            </div>
                            <div class="card-body">
                                <div id="maintenanceLog"
                                    style="max-height: 200px; overflow-y: auto; background-color: #f8f9fa; padding: 1rem; border-radius: 0.375rem;">
                                    <div class="text-muted">No maintenance activities logged yet.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-outline-info" onclick="exportMaintenanceReport()">
                    <i class="bi bi-download"></i> Export Report
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Emergency Stop Confirmation Modal -->
<div class="modal fade" id="emergencyStopModal" tabindex="-1" aria-labelledby="emergencyStopModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="emergencyStopModalLabel">
                    <i class="bi bi-exclamation-triangle"></i> Emergency Stop Confirmation
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-danger">
                    <h6><i class="bi bi-exclamation-triangle"></i> Warning: Emergency Stop</h6>
                    <p>This action will immediately:</p>
                    <ul>
                        <li>Cancel all running jobs</li>
                        <li>Clear the job queue</li>
                        <li>Prevent new job submissions</li>
                        <li>Notify all users of the system shutdown</li>
                    </ul>
                    <p><strong>This action cannot be undone.</strong></p>
                </div>

                <div class="mb-3">
                    <label for="emergencyReason" class="form-label">Emergency Reason (Required)</label>
                    <textarea class="form-control" id="emergencyReason" rows="3"
                        placeholder="Explain the reason for emergency stop..." required></textarea>
                </div>

                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="confirmEmergencyStop">
                    <label class="form-check-label" for="confirmEmergencyStop">
                        I understand the consequences and want to proceed with emergency stop
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="executeEmergencyStop" onclick="executeEmergencyStop()"
                    disabled>
                    <i class="bi bi-stop-circle"></i> Execute Emergency Stop
                </button>
            </div>
        </div>
    </div>
</div>