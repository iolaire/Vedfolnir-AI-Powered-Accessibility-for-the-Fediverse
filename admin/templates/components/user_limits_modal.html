<!-- Copyright (C) 2025 iolaire mcfadden. -->
<!-- This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. -->
<!-- THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE. -->

<!-- User Limits Modal -->
<div class="modal fade" id="userLimitsModal" tabindex="-1" aria-labelledby="userLimitsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="userLimitsModalLabel">
                    <i class="bi bi-sliders"></i> User Job Limits & Permissions
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Select User</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="userSearch" class="form-label">Search and Select a user to configure
                                        their limits</label>
                                    <input type="text" class="form-control" id="userSearch"
                                        placeholder="Type username or email to search..." autocomplete="off">
                                    <div id="userSearchResults" class="dropdown-menu w-100"
                                        style="display: none; max-height: 200px; overflow-y: auto;">
                                        <!-- Search results will appear here -->
                                    </div>
                                </div>
                                <div id="usersList" style="max-height: 300px; overflow-y: auto;">
                                    <div class="text-center text-muted py-3">
                                        <i class="bi bi-search"></i>
                                        <p class="mb-0">Start typing to search for users</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">User Limits Configuration</h6>
                            </div>
                            <div class="card-body">
                                <div id="userLimitsForm" style="display: none;">
                                    <form id="limitsConfigForm">
                                        <input type="hidden" id="selectedUserId">

                                        <div class="mb-3">
                                            <h6>Selected User: <span id="selectedUserName" class="text-primary"></span>
                                            </h6>
                                            <small class="text-muted">Email: <span
                                                    id="selectedUserEmail"></span></small>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="maxConcurrentJobs" class="form-label">
                                                        Max Concurrent Jobs
                                                        <i class="bi bi-info-circle"
                                                            title="Maximum number of jobs this user can run simultaneously"></i>
                                                    </label>
                                                    <input type="number" class="form-control" id="maxConcurrentJobs"
                                                        min="0" max="10" value="2">
                                                </div>

                                                <div class="mb-3">
                                                    <label for="maxDailyJobs" class="form-label">
                                                        Max Daily Jobs
                                                        <i class="bi bi-info-circle"
                                                            title="Maximum number of jobs this user can create per day"></i>
                                                    </label>
                                                    <input type="number" class="form-control" id="maxDailyJobs" min="0"
                                                        max="100" value="10">
                                                </div>

                                                <div class="mb-3">
                                                    <label for="maxImagesPerJob" class="form-label">
                                                        Max Images Per Job
                                                        <i class="bi bi-info-circle"
                                                            title="Maximum number of images per caption generation job"></i>
                                                    </label>
                                                    <input type="number" class="form-control" id="maxImagesPerJob"
                                                        min="1" max="1000" value="50">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="jobPriority" class="form-label">Default Job
                                                        Priority</label>
                                                    <select class="form-select" id="jobPriority">
                                                        <option value="low">Low</option>
                                                        <option value="normal" selected>Normal</option>
                                                        <option value="high">High</option>
                                                    </select>
                                                </div>

                                                <div class="mb-3">
                                                    <label for="jobTimeoutMinutes" class="form-label">
                                                        Job Timeout (minutes)
                                                        <i class="bi bi-info-circle"
                                                            title="Maximum time a job can run before being cancelled"></i>
                                                    </label>
                                                    <input type="number" class="form-control" id="jobTimeoutMinutes"
                                                        min="5" max="180" value="30">
                                                </div>

                                                <div class="mb-3">
                                                    <label for="cooldownMinutes" class="form-label">
                                                        Cooldown Period (minutes)
                                                        <i class="bi bi-info-circle"
                                                            title="Minimum time between job submissions"></i>
                                                    </label>
                                                    <input type="number" class="form-control" id="cooldownMinutes"
                                                        min="0" max="60" value="5">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="mb-3">
                                            <h6>Permissions</h6>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="canCreateJobs"
                                                    checked>
                                                <label class="form-check-label" for="canCreateJobs">
                                                    Can create caption generation jobs
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="canCancelOwnJobs"
                                                    checked>
                                                <label class="form-check-label" for="canCancelOwnJobs">
                                                    Can cancel own jobs
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="canViewJobHistory"
                                                    checked>
                                                <label class="form-check-label" for="canViewJobHistory">
                                                    Can view job history
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="canRetryFailedJobs"
                                                    checked>
                                                <label class="form-check-label" for="canRetryFailedJobs">
                                                    Can retry failed jobs
                                                </label>
                                            </div>
                                        </div>

                                        <div class="mb-3">
                                            <label for="userNotes" class="form-label">Admin Notes</label>
                                            <textarea class="form-control" id="userNotes" rows="3"
                                                placeholder="Administrative notes about this user's limits..."></textarea>
                                        </div>
                                    </form>
                                </div>
                                <div id="noUserSelected" class="text-center text-muted py-4">
                                    <i class="bi bi-person-plus"></i>
                                    <p>Search and select a user to configure their limits</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-outline-warning" id="resetUserLimits" onclick="resetUserLimits()"
                    style="display: none;">
                    <i class="bi bi-arrow-clockwise"></i> Reset to Defaults
                </button>
                <button type="button" class="btn btn-primary" id="saveUserLimits" onclick="saveUserLimits()"
                    style="display: none;">
                    <i class="bi bi-save"></i> Save Limits
                </button>
            </div>
        </div>
    </div>
</div>

<!-- User List Item Template -->
<template id="userListItemTemplate">
    <div class="user-item p-2 border-bottom" style="cursor: pointer;" onclick="selectUser(this)">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <strong class="user-name"></strong>
                <br><small class="text-muted user-email"></small>
            </div>
            <div>
                <span class="badge user-role"></span>
                <br><small class="text-muted user-status"></small>
            </div>
        </div>
    </div>
</template>