<!-- Copyright (C) 2025 iolaire mcfadden. -->
<!-- This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. -->
<!-- THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE. -->

{% extends "base.html" %}

{% block title %}Login - Vedfolnir{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-4">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0 text-center">
                        <i class="fas fa-sign-in-alt me-2"></i>Sign In
                    </h4>
                </div>
                <div class="card-body p-4">
                    <p class="text-muted text-center mb-4">
                        Welcome back to Vedfolnir
                    </p>

                    <form method="POST" novalidate>
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        
                        <!-- Username or Email Field -->
                        <div class="mb-3">
                            {{ form.username_or_email.label(class="form-label") }}
                            {{ form.username_or_email(class="form-control" + (" is-invalid" if form.username_or_email.errors else "")) }}
                            {% if form.username_or_email.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.username_or_email.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <!-- Password Field -->
                        <div class="mb-3">
                            {{ form.password.label(class="form-label") }}
                            <div class="input-group">
                                {{ form.password(class="form-control" + (" is-invalid" if form.password.errors else ""), id="password") }}
                                <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                    <i class="fas fa-eye" id="togglePasswordIcon"></i>
                                </button>
                            </div>
                            {% if form.password.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.password.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <!-- Remember Me -->
                        <div class="mb-3">
                            <div class="form-check">
                                {{ form.remember_me(class="form-check-input") }}
                                {{ form.remember_me.label(class="form-check-label") }}
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="d-grid">
                            {{ form.submit(class="btn btn-primary btn-lg") }}
                        </div>
                    </form>

                    <!-- Additional Links -->
                    <div class="text-center mt-4">
                        <p class="text-muted mb-2">
                            <a href="{{ url_for('user_management.forgot_password') }}" class="text-decoration-none">
                                Forgot your password?
                            </a>
                        </p>
                        <p class="text-muted">
                            Don't have an account? 
                            <a href="{{ url_for('user_management.register') }}" class="text-decoration-none">Sign up here</a>
                        </p>
                    </div>

                    <!-- Email Verification Notice -->
                    <!-- Unified Notification System Integration -->
<!-- Flash messages are now handled by the WebSocket-based notification system -->
<!-- See static/js/websocket-client-factory.js for notification handling -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Password Toggle Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const toggle = document.getElementById('togglePassword');
    const password = document.getElementById('password');
    const icon = document.getElementById('togglePasswordIcon');
    
    if (toggle && password && icon) {
        toggle.addEventListener('click', function() {
            const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
            password.setAttribute('type', type);
            
            if (type === 'text') {
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        });
    }
});
</script>
{% endblock %}