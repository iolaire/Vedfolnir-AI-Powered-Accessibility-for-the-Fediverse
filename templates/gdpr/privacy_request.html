<!-- Copyright (C) 2025 iolaire mcfadden. -->
<!-- This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. -->
<!-- THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE. -->

{% extends "base.html" %}

{% block title %}Privacy Request - Vedfolnir{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="mb-0">
                        <i class="fas fa-envelope me-2"></i>
                        Submit Privacy Request
                    </h3>
                    <small class="text-muted">Exercise your privacy rights or contact our privacy team</small>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Privacy Support</strong><br>
                        Use this form to exercise your privacy rights, ask questions about data processing, or report privacy concerns. 
                        We will respond within 30 days as required by GDPR.
                    </div>

                    <form method="POST">
                        {{ form.hidden_tag() }}
                        
                        <div class="mb-3">
                            {{ form.request_type.label(class="form-label") }}
                            {{ form.request_type(class="form-select") }}
                            <div class="form-text">{{ form.request_type.description }}</div>
                            {% if form.request_type.errors %}
                                <div class="text-danger">
                                    {% for error in form.request_type.errors %}
                                        <small>{{ error }}</small><br>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            {{ form.request_details.label(class="form-label") }}
                            {{ form.request_details(class="form-control", rows="6") }}
                            <div class="form-text">{{ form.request_details.description }}</div>
                            {% if form.request_details.errors %}
                                <div class="text-danger">
                                    {% for error in form.request_details.errors %}
                                        <small>{{ error }}</small><br>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    {{ form.preferred_response.label(class="form-label") }}
                                    {{ form.preferred_response(class="form-select") }}
                                    <div class="form-text">{{ form.preferred_response.description }}</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    {{ form.urgency.label(class="form-label") }}
                                    {{ form.urgency(class="form-select") }}
                                    <div class="form-text">{{ form.urgency.description }}</div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3" id="urgency-reason-field" style="display: none;">
                            {{ form.urgency_reason.label(class="form-label") }}
                            {{ form.urgency_reason(class="form-control", rows="3") }}
                            <div class="form-text">{{ form.urgency_reason.description }}</div>
                        </div>

                        <div class="alert alert-secondary">
                            <h6><i class="fas fa-clock me-2"></i>Response Timeline</h6>
                            <ul class="mb-0">
                                <li><strong>Standard requests:</strong> 30 days maximum</li>
                                <li><strong>Complex requests:</strong> May extend to 60 days with notification</li>
                                <li><strong>Urgent requests:</strong> Prioritized based on justification</li>
                                <li><strong>Security issues:</strong> Immediate attention</li>
                            </ul>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{{ url_for('profile.profile') }}" class="btn btn-secondary me-md-2">Cancel</a>
                            {{ form.submit(class="btn btn-primary") }}
                        </div>
                    </form>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <h6><i class="fas fa-download me-2"></i>Export Data</h6>
                            <p class="small">Get a copy of all your personal data</p>
                            <a href="{{ url_for('gdpr.data_export') }}" class="btn btn-sm btn-outline-primary w-100">Export Now</a>
                        </div>
                        <div class="col-md-4">
                            <h6><i class="fas fa-edit me-2"></i>Correct Data</h6>
                            <p class="small">Fix inaccurate or incomplete information</p>
                            <a href="{{ url_for('gdpr.data_rectification') }}" class="btn btn-sm btn-outline-success w-100">Correct Now</a>
                        </div>
                        <div class="col-md-4">
                            <h6><i class="fas fa-shield-alt me-2"></i>Manage Consent</h6>
                            <p class="small">Update your privacy preferences</p>
                            <a href="{{ url_for('gdpr.consent_management') }}" class="btn btn-sm btn-outline-info w-100">Manage Now</a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">Common Privacy Requests</h5>
                </div>
                <div class="card-body">
                    <div class="accordion" id="commonRequests">
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                                    What data do you have about me?
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#commonRequests">
                                <div class="accordion-body">
                                    <p>This is a <strong>Right to Access</strong> request. You can:</p>
                                    <ul>
                                        <li>Use our <a href="{{ url_for('gdpr.data_export') }}">data export tool</a> for immediate access</li>
                                        <li>Submit a privacy request above for detailed information</li>
                                        <li>View your <a href="{{ url_for('gdpr.data_processing_info') }}">data processing information</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingTwo">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                                    I want to delete my account and data
                                </button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#commonRequests">
                                <div class="accordion-body">
                                    <p>This is a <strong>Right to Erasure</strong> request. You can:</p>
                                    <ul>
                                        <li>Use our <a href="{{ url_for('gdpr.data_erasure') }}">account deletion tool</a> for immediate processing</li>
                                        <li>Choose between complete deletion or anonymization</li>
                                        <li>Export your data first if you want to keep a copy</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingThree">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
                                    I want to withdraw my consent
                                </button>
                            </h2>
                            <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#commonRequests">
                                <div class="accordion-body">
                                    <p>This is a <strong>Right to Withdraw Consent</strong> request. You can:</p>
                                    <ul>
                                        <li>Use our <a href="{{ url_for('gdpr.consent_management') }}">consent management tool</a> to withdraw specific consents</li>
                                        <li>Update your preferences immediately</li>
                                        <li>Understand the impact on your account functionality</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingFour">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour">
                                    I want to transfer my data to another service
                                </button>
                            </h2>
                            <div id="collapseFour" class="accordion-collapse collapse" data-bs-parent="#commonRequests">
                                <div class="accordion-body">
                                    <p>This is a <strong>Right to Data Portability</strong> request. You can:</p>
                                    <ul>
                                        <li>Use our <a href="{{ url_for('gdpr.data_portability') }}">data portability tool</a> for machine-readable exports</li>
                                        <li>Choose from multiple export formats</li>
                                        <li>Get structured data that's easy to import elsewhere</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const urgencySelect = document.getElementById('urgency');
    const urgencyReasonField = document.getElementById('urgency-reason-field');
    
    function toggleUrgencyReason() {
        if (urgencySelect.value === 'urgent' || urgencySelect.value === 'legal') {
            urgencyReasonField.style.display = 'block';
        } else {
            urgencyReasonField.style.display = 'none';
        }
    }
    
    urgencySelect.addEventListener('change', toggleUrgencyReason);
    toggleUrgencyReason(); // Initial check
    
    // Auto-expand textarea as user types
    const textarea = document.getElementById('request_details');
    textarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
    });
});
</script>
{% endblock %}